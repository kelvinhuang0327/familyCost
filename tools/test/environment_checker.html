<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç’°å¢ƒæª¢æ¸¬å™¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .env-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .env-info h3 {
            margin-top: 0;
            color: #fff;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }
        
        .error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid #f44336;
            color: #f44336;
        }
        
        .warning {
            background: rgba(255, 152, 0, 0.3);
            border: 1px solid #FF9800;
            color: #FF9800;
        }
        
        .info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid #2196F3;
            color: #2196F3;
        }
        
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #45a049;
        }
        
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .recommendations {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .recommendations h3 {
            margin-top: 0;
            color: #fff;
        }
        
        .recommendations ul {
            padding-left: 20px;
        }
        
        .recommendations li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .recommendations a {
            color: #81C784;
            text-decoration: none;
        }
        
        .recommendations a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç’°å¢ƒæª¢æ¸¬å™¨</h1>
        
        <div class="env-info">
            <h3>ğŸ“ ç•¶å‰ç’°å¢ƒä¿¡æ¯</h3>
            <div id="envDetails"></div>
        </div>
        
        <div class="env-info">
            <h3>ğŸ§ª å¾Œç«¯é€£æ¥æ¸¬è©¦</h3>
            <button class="test-button" onclick="testBackend()">æ¸¬è©¦å¾Œç«¯é€£æ¥</button>
            <button class="test-button" onclick="testTokenAPI()">æ¸¬è©¦ Token API</button>
            <div id="testResults"></div>
        </div>
        
        <div class="recommendations">
            <h3>ğŸ’¡ å»ºè­°</h3>
            <div id="recommendations"></div>
        </div>
    </div>

    <script>
        // æª¢æ¸¬ç’°å¢ƒ
        function detectEnvironment() {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            const port = window.location.port;
            
            let env = 'unknown';
            let description = '';
            let backendUrl = '';
            let features = [];
            
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                env = 'local';
                description = 'æœ¬åœ°é–‹ç™¼ç’°å¢ƒ';
                backendUrl = 'http://localhost:3001';
                features = ['âœ… å®Œæ•´å¾Œç«¯æ”¯æŒ', 'âœ… Token å„²å­˜', 'âœ… æ•¸æ“šåŒæ­¥', 'âœ… æ‰€æœ‰åŠŸèƒ½'];
            } else if (hostname.includes('vercel.app')) {
                env = 'vercel';
                description = 'Vercel é›²ç«¯ç’°å¢ƒ';
                backendUrl = window.location.origin;
                features = ['âœ… å®Œæ•´å¾Œç«¯æ”¯æŒ', 'âœ… Token å„²å­˜', 'âœ… æ•¸æ“šåŒæ­¥', 'âœ… æ‰€æœ‰åŠŸèƒ½'];
            } else if (hostname.includes('github.io')) {
                env = 'github-pages';
                description = 'GitHub Pages éœæ…‹ç’°å¢ƒ';
                backendUrl = 'ä¸æ”¯æŒå¾Œç«¯';
                features = ['âŒ ç„¡å¾Œç«¯æ”¯æŒ', 'âŒ Token å„²å­˜ä¸å¯ç”¨', 'âŒ æ•¸æ“šåŒæ­¥ä¸å¯ç”¨', 'âš ï¸ åƒ…éœæ…‹å±•ç¤º'];
            } else {
                env = 'other';
                description = 'å…¶ä»–ç’°å¢ƒ';
                backendUrl = 'æœªçŸ¥';
                features = ['â“ éœ€è¦æª¢æ¸¬'];
            }
            
            return {
                env,
                description,
                hostname,
                protocol,
                port,
                backendUrl,
                features,
                fullUrl: window.location.href
            };
        }
        
        // æ¸¬è©¦å¾Œç«¯é€£æ¥
        async function testBackend() {
            const env = detectEnvironment();
            const resultsDiv = document.getElementById('testResults');
            
            resultsDiv.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨æ¸¬è©¦å¾Œç«¯é€£æ¥...</div>';
            
            try {
                let testUrl;
                if (env.env === 'local') {
                    testUrl = 'http://localhost:3001/api/health';
                } else if (env.env === 'vercel') {
                    testUrl = window.location.origin + '/api/health';
                } else {
                    testUrl = env.backendUrl + '/api/health';
                }
                
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="status success">âœ… å¾Œç«¯é€£æ¥æˆåŠŸï¼</div>
                        <div class="status info">
                            <strong>æœå‹™ç‹€æ…‹:</strong> ${data.status}<br>
                            <strong>ç’°å¢ƒ:</strong> ${data.environment}<br>
                            <strong>ç‰ˆæœ¬:</strong> ${data.version}<br>
                            <strong>æ™‚é–“:</strong> ${new Date(data.timestamp).toLocaleString()}
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="status error">âŒ å¾Œç«¯é€£æ¥å¤±æ•—</div>
                        <div class="status warning">HTTP ç‹€æ…‹: ${response.status}</div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="status error">âŒ å¾Œç«¯é€£æ¥å¤±æ•—</div>
                    <div class="status warning">éŒ¯èª¤: ${error.message}</div>
                `;
            }
        }
        
        // æ¸¬è©¦ Token API
        async function testTokenAPI() {
            const env = detectEnvironment();
            const resultsDiv = document.getElementById('testResults');
            
            resultsDiv.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨æ¸¬è©¦ Token API...</div>';
            
            try {
                let testUrl;
                if (env.env === 'local') {
                    testUrl = 'http://localhost:3001/api/token/status';
                } else if (env.env === 'vercel') {
                    testUrl = window.location.origin + '/api/token/status';
                } else {
                    testUrl = env.backendUrl + '/api/token/status';
                }
                
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="status success">âœ… Token API å¯ç”¨ï¼</div>
                        <div class="status info">
                            <strong>Token ç‹€æ…‹:</strong> ${data.hasToken ? 'å·²å„²å­˜' : 'æœªå„²å­˜'}<br>
                            <strong>ç”¨æˆ¶:</strong> ${data.tokenInfo ? data.tokenInfo.user : 'N/A'}<br>
                            <strong>å‰µå»ºæ™‚é–“:</strong> ${data.tokenInfo ? new Date(data.tokenInfo.createdAt).toLocaleString() : 'N/A'}
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="status error">âŒ Token API ä¸å¯ç”¨</div class="status warning">HTTP ç‹€æ…‹: ${response.status}</div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="status error">âŒ Token API ä¸å¯ç”¨</div>
                    <div class="status warning">éŒ¯èª¤: ${error.message}</div>
                `;
            }
        }
        
        // ç”Ÿæˆå»ºè­°
        function generateRecommendations() {
            const env = detectEnvironment();
            const recommendationsDiv = document.getElementById('recommendations');
            
            let recommendations = [];
            
            if (env.env === 'local') {
                recommendations = [
                    '<li>âœ… <strong>æœ¬åœ°ç’°å¢ƒ</strong> - æ‰€æœ‰åŠŸèƒ½å®Œå…¨å¯ç”¨</li>',
                    '<li>ğŸ¯ å»ºè­°ç¹¼çºŒä½¿ç”¨æœ¬åœ°ç’°å¢ƒé€²è¡Œé–‹ç™¼å’Œæ¸¬è©¦</li>',
                    '<li>ğŸ’¡ å¦‚éœ€é›²ç«¯éƒ¨ç½²ï¼Œå¯è€ƒæ…® <a href="https://family-cost.vercel.app" target="_blank">Vercel ç’°å¢ƒ</a></li>'
                ];
            } else if (env.env === 'vercel') {
                recommendations = [
                    '<li>âœ… <strong>Vercel ç’°å¢ƒ</strong> - é›²ç«¯å®Œæ•´åŠŸèƒ½</li>',
                    '<li>ğŸ¯ æ‰€æœ‰å¾Œç«¯åŠŸèƒ½éƒ½å¯ç”¨ï¼ŒåŒ…æ‹¬ Token å„²å­˜</li>',
                    '<li>ğŸ’¡ å¦‚éœ€æœ¬åœ°é–‹ç™¼ï¼Œå¯è¨ªå• <a href="http://localhost:8000" target="_blank">æœ¬åœ°ç’°å¢ƒ</a></li>'
                ];
            } else if (env.env === 'github-pages') {
                recommendations = [
                    '<li>âŒ <strong>GitHub Pages ç’°å¢ƒ</strong> - åŠŸèƒ½å—é™</li>',
                    '<li>âš ï¸ ä¸æ”¯æŒå¾Œç«¯æœå‹™ï¼ŒToken å„²å­˜åŠŸèƒ½ä¸å¯ç”¨</li>',
                    '<li>ğŸ’¡ å»ºè­°ä½¿ç”¨ <a href="http://localhost:8000" target="_blank">æœ¬åœ°ç’°å¢ƒ</a> æˆ– <a href="https://family-cost.vercel.app" target="_blank">Vercel ç’°å¢ƒ</a></li>'
                ];
            } else {
                recommendations = [
                    '<li>â“ <strong>æœªçŸ¥ç’°å¢ƒ</strong> - éœ€è¦é€²ä¸€æ­¥æª¢æ¸¬</li>',
                    '<li>ğŸ’¡ å»ºè­°ä½¿ç”¨ <a href="http://localhost:8000" target="_blank">æœ¬åœ°ç’°å¢ƒ</a> æˆ– <a href="https://family-cost.vercel.app" target="_blank">Vercel ç’°å¢ƒ</a></li>'
                ];
            }
            
            recommendationsDiv.innerHTML = '<ul>' + recommendations.join('') + '</ul>';
        }
        
        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.onload = function() {
            const env = detectEnvironment();
            
            document.getElementById('envDetails').innerHTML = `
                <div class="status info">
                    <strong>ç’°å¢ƒé¡å‹:</strong> ${env.description}<br>
                    <strong>ä¸»æ©Ÿå:</strong> ${env.hostname}<br>
                    <strong>å”è­°:</strong> ${env.protocol}<br>
                    <strong>ç«¯å£:</strong> ${env.port || 'é»˜èª'}<br>
                    <strong>å®Œæ•´URL:</strong> ${env.fullUrl}<br>
                    <strong>å¾Œç«¯URL:</strong> ${env.backendUrl}
                </div>
                <div class="status ${env.env === 'local' || env.env === 'vercel' ? 'success' : 'warning'}">
                    <strong>åŠŸèƒ½æ”¯æŒ:</strong><br>
                    ${env.features.join('<br>')}
                </div>
            `;
            
            generateRecommendations();
        };
    </script>
</body>
</html>
