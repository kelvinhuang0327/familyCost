<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>家庭收支平台</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>💰</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-main">
                    <h1>💰 收支平台</h1>
                    <p>輕鬆管理您的財務</p>
                </div>
                <div class="version-info">
                    <span class="version-label">版本</span>
                    <span class="version-number" id="versionNumber">載入中...</span>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">
                <i>📊</i>
                <span>總覽</span>
            </button>
            <button class="nav-tab" onclick="showTab('list')">
                <i>📋</i>
                <span>列表</span>
            </button>
            <button class="nav-tab" onclick="showTab('calendar')">
                <i>📅</i>
                <span>日曆</span>
            </button>
            <button class="nav-tab" onclick="showTab('charts')">
                <i>📈</i>
                <span>圖表</span>
            </button>
            <button class="nav-tab" onclick="showTab('add')">
                <i>➕</i>
                <span>新增</span>
            </button>
            <button class="nav-tab" onclick="showTab('import')">
                <i>⚙️</i>
                <span>設定</span>
            </button>
        </div>

        <div class="content">
            <!-- 總覽頁面 -->
            <div id="dashboard" class="tab-content active">
                <!-- 查詢選擇器 -->
                <div class="query-selector" id="dashboardQuerySelector">
                    <div class="query-selector-content">
                        <!-- 查詢方式選擇 -->
                        <div class="query-method">
                            <label for="dashboardDateRangeSelect">查詢方式：</label>
                            <select id="dashboardDateRangeSelect" onchange="changeDashboardDateRange()">
                                <option value="month">月份查詢</option>
                                <option value="range">日期區間</option>
                            </select>
                        </div>
                        
                        <!-- 月份選擇器 -->
                        <div class="month-selector" id="dashboardMonthSelector">
                            <label for="dashboardMonthSelect">選擇月份：</label>
                            <select id="dashboardMonthSelect" onchange="changeDashboardMonth()">
                                <option value="">顯示全部</option>
                                <option value="2025-01">2025年1月</option>
                                <option value="2025-02">2025年2月</option>
                                <option value="2025-03">2025年3月</option>
                                <option value="2025-04">2025年4月</option>
                                <option value="2025-05">2025年5月</option>
                                <option value="2025-06">2025年6月</option>
                                <option value="2025-07">2025年7月</option>
                                <option value="2025-08">2025年8月</option>
                                <option value="2025-09">2025年9月</option>
                                <option value="2025-10">2025年10月</option>
                                <option value="2025-11">2025年11月</option>
                                <option value="2025-12">2025年12月</option>
                                <option value="2024-01">2024年1月</option>
                                <option value="2024-02">2024年2月</option>
                                <option value="2024-03">2024年3月</option>
                                <option value="2024-04">2024年4月</option>
                                <option value="2024-05">2024年5月</option>
                                <option value="2024-06">2024年6月</option>
                                <option value="2024-07">2024年7月</option>
                                <option value="2024-08">2024年8月</option>
                                <option value="2024-09">2024年9月</option>
                                <option value="2024-10">2024年10月</option>
                                <option value="2024-11">2024年11月</option>
                                <option value="2024-12">2024年12月</option>
                            </select>
                        </div>
                        
                        <!-- 日期區間選擇器 -->
                        <div class="date-range-inputs" id="dashboardDateRangeInputs" style="display: none;">
                            <label for="dashboardStartDate">開始日期：</label>
                            <input type="date" id="dashboardStartDate" onchange="changeDashboardDateRange.call(this)">
                            <label for="dashboardEndDate">結束日期：</label>
                            <input type="date" id="dashboardEndDate" onchange="changeDashboardDateRange.call(this)">
                        </div>
                    </div>
                </div>
                <div class="stats-section">
                    <h3>📊 支出統計</h3>
                    <div class="stats">
                        <div class="stat-card">
                            <h3 id="totalExpense">$0</h3>
                            <p>總支出</p>
                        </div>
                        <div class="stat-card">
                            <h3 id="creditExpense">$0</h3>
                            <p>信用卡支出</p>
                        </div>
                    </div>
                </div>
                <div class="swipe-indicator" id="statsSwipeIndicator"></div>
                <div class="member-stats">
                    <h3>👥 成員收支統計</h3>
                    <div class="member-stats-grid" id="memberStats"></div>
                    <div class="member-indicators" id="memberIndicators"></div>
                    <div class="swipe-indicator" id="memberSwipeIndicator"></div>
                </div>
                <div class="records-list">
                    <h3>記錄查看</h3>
                    <div class="record-filter-tabs">
                        <button class="filter-tab active" onclick="showExpenseRecords()">支出</button>
                        <button class="filter-tab" onclick="showCashExpenseRecords()">現金</button>
                        <button class="filter-tab" onclick="showCreditExpenseRecords()">信用卡</button>
                        <button class="filter-tab" onclick="showIncomeRecords()">收入</button>
                        <button class="filter-tab" onclick="showAllRecords()">全部</button>
                    </div>
                    <div id="recentRecords"></div>
                </div>
            </div>

            <!-- 列表頁面 -->
            <div id="list" class="tab-content">
                <!-- 查詢選擇器 -->
                <div class="query-selector" id="listQuerySelector">
                    <div class="query-selector-content">
                        <!-- 查詢方式選擇 -->
                        <div class="query-method">
                            <label for="listDateRangeSelect">查詢方式：</label>
                            <select id="listDateRangeSelect" onchange="changeListDateRange()">
                                <option value="month">月份查詢</option>
                                <option value="range">日期區間</option>
                            </select>
                        </div>
                        
                        <!-- 月份選擇器 -->
                        <div class="month-selector" id="listMonthSelector">
                            <label for="listMonthSelect">選擇月份：</label>
                            <select id="listMonthSelect" onchange="changeListMonth()">
                                <option value="">顯示全部</option>
                                <option value="2025-01">2025年1月</option>
                                <option value="2025-02">2025年2月</option>
                                <option value="2025-03">2025年3月</option>
                                <option value="2025-04">2025年4月</option>
                                <option value="2025-05">2025年5月</option>
                                <option value="2025-06">2025年6月</option>
                                <option value="2025-07">2025年7月</option>
                                <option value="2025-08">2025年8月</option>
                                <option value="2025-09">2025年9月</option>
                                <option value="2025-10">2025年10月</option>
                                <option value="2025-11">2025年11月</option>
                                <option value="2025-12">2025年12月</option>
                                <option value="2024-01">2024年1月</option>
                                <option value="2024-02">2024年2月</option>
                                <option value="2024-03">2024年3月</option>
                                <option value="2024-04">2024年4月</option>
                                <option value="2024-05">2024年5月</option>
                                <option value="2024-06">2024年6月</option>
                                <option value="2024-07">2024年7月</option>
                                <option value="2024-08">2024年8月</option>
                                <option value="2024-09">2024年9月</option>
                                <option value="2024-10">2024年10月</option>
                                <option value="2024-11">2024年11月</option>
                                <option value="2024-12">2024年12月</option>
                            </select>
                        </div>
                        
                        <!-- 日期區間選擇器 -->
                        <div class="date-range-inputs" id="listDateRangeInputs" style="display: none;">
                            <label for="listStartDate">開始日期：</label>
                            <input type="date" id="listStartDate" onchange="changeListDateRange.call(this)">
                            <label for="listEndDate">結束日期：</label>
                            <input type="date" id="listEndDate" onchange="changeListDateRange.call(this)">
                        </div>
                    </div>
                </div>
                <div class="filter-bar">
                    <input type="text" id="searchInput" placeholder="搜尋記錄..." onkeyup="filterRecords()">
                    <select id="memberFilter" onchange="filterRecords()">
                        <option value="">所有成員</option>
                        <option value="Kelvin">Kelvin</option>
                        <option value="Phuong">Phuong</option>
                        <option value="Ryan">Ryan</option>
                        <option value="家用">家用</option>
                    </select>
                    <select id="typeFilter" onchange="filterRecords()">
                        <option value="">所有類型</option>
                        <option value="income">收入</option>
                        <option value="expense">支出</option>
                    </select>
                    <input type="date" id="dateFilter" onchange="filterRecords()">
                </div>
                <div class="records-list">
                    <div id="allRecords"></div>
                </div>
            </div>

            <!-- 日曆頁面 -->
            <div id="calendar" class="tab-content">
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="changeMonth(-1)">‹ 上月</button>
                        <div class="calendar-title" id="calendarTitle"></div>
                        <button class="calendar-nav" onclick="changeMonth(1)">下月 ›</button>
                    </div>
                    <div class="calendar-weekdays">
                        <div class="calendar-weekday">日</div>
                        <div class="calendar-weekday">一</div>
                        <div class="calendar-weekday">二</div>
                        <div class="calendar-weekday">三</div>
                        <div class="calendar-weekday">四</div>
                        <div class="calendar-weekday">五</div>
                        <div class="calendar-weekday">六</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>

            <!-- 圖表頁面 -->
            <div id="charts" class="tab-content">
                <div class="chart-controls">
                    <div class="chart-filter-bar">
                        <select id="chartYear" onchange="updateCharts()">
                            <option value="2024">2024年</option>
                            <option value="2025" selected>2025年</option>
                        </select>
                        <select id="chartMonth" onchange="updateCharts()">
                            <option value="1">1月</option>
                            <option value="2">2月</option>
                            <option value="3">3月</option>
                            <option value="4">4月</option>
                            <option value="5">5月</option>
                            <option value="6">6月</option>
                            <option value="7">7月</option>
                            <option value="8">8月</option>
                            <option value="9">9月</option>
                            <option value="10">10月</option>
                            <option value="11">11月</option>
                            <option value="12">12月</option>
                        </select>
                        <button class="btn" onclick="refreshCharts()">🔄 重新整理</button>
                    </div>
                </div>

                <!-- 收支趨勢圖表 -->
                <div class="chart-section">
                    <h3>📈 收支趨勢</h3>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- 類別統計圖表 -->
                <div class="chart-section">
                    <h3>🥧 類別統計</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- 成員收支對比 -->
                <div class="chart-section">
                    <h3>👥 成員收支對比</h3>
                    <div class="chart-container">
                        <canvas id="memberChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- 新增頁面 -->
            <div id="add" class="tab-content">
                <form id="recordForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="member">成員</label>
                            <select id="member" required>
                                <option value="">請選擇</option>
                                <option value="Kelvin">Kelvin</option>
                                <option value="Phuong">Phuong</option>
                                <option value="Ryan">Ryan</option>
                                <option value="家用">家用</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="type">類型</label>
                            <select id="type" required onchange="handleTypeChange()">
                                <option value="">請選擇</option>
                                <option value="income">收入</option>
                                <option value="expense">支出</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="amount">金額</label>
                            <input type="number" id="amount" step="0.01" required placeholder="輸入金額（正數）">
                        </div>
                        <div class="form-group">
                            <label for="date">日期</label>
                            <input type="date" id="date" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mainCategory">主類別</label>
                            <select id="mainCategory" required onchange="handleMainCategoryChange()">
                                <option value="">請選擇</option>
                            </select>
                            <input type="text" id="customMainCategory" placeholder="請輸入自定義主類別" style="display: none; margin-top: 10px;">
                        </div>
                        <div class="form-group">
                            <label for="subCategory">付款方式</label>
                            <select id="subCategory" required>
                                <option value="">請選擇付款方式</option>
                                <option value="信用卡">信用卡</option>
                                <option value="現金">現金</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="description">描述</label>
                        <textarea id="description" rows="3" placeholder="請輸入詳細描述..."></textarea>
                    </div>
                    <button type="submit" class="btn">新增記錄</button>
                </form>
            </div>

            <!-- 設定頁面 -->
            <div id="import" class="tab-content">
                <!-- 數據匯入功能 -->
                <div class="import-section">
                    <h3>📥 數據匯入</h3>
                    <p>支援 Excel 檔案匯入</p>
                    
                    <!-- Excel匯入格式說明 -->
                    <div class="import-format-info">
                        <p><strong>Excel 檔案格式</strong>：成員、金額、類別、主類別、付款方式、描述、日期</p>
                    </div>
                    
                    <div class="excel-import-section">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-content">
                                <div class="upload-icon">📁</div>
                                <p id="uploadDescription">點擊或拖拽 Excel 檔案到此處</p>
                                <p class="upload-hint">支援 .xlsx 和 .xls 格式，最大 10MB</p>
                                <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;">
                                <button class="btn" onclick="document.getElementById('excelFileInput').click()">選擇檔案</button>
            </div>
        </div>
                    
                        <div id="compareResult" class="compare-result" style="display: none;">
                            <h4>📋 比對結果</h4>
                            <div class="result-summary">
                                <div class="summary-item">
                                    <span class="label">Excel 總記錄數:</span>
                                    <span class="value" id="totalExcelRecords">0</span>
                            </div>
                                <div class="summary-item">
                                    <span class="label">系統現有記錄數:</span>
                                    <span class="value" id="systemRecords">0</span>
                            </div>
                                <div class="summary-item new">
                                    <span class="label">可新增記錄數:</span>
                                    <span class="value" id="newRecords">0</span>
                        </div>
                                <div class="summary-item duplicate">
                                    <span class="label">重複記錄數:</span>
                                    <span class="value" id="duplicateRecords">0</span>
                    </div>
                </div>

                            <div class="result-actions">
                                <button class="btn btn-primary" id="importBtn" disabled>
                                    📥 選擇匯入記錄
                                </button>
                                <button class="btn btn-success" id="importAllBtn" style="display: none;">
                                    📥 匯入全部記錄
                                </button>
                                <button class="btn btn-secondary" onclick="clearCompareResult()">
                                    🔄 重新比對
                                </button>
                            </div>
                            
                            <div id="newRecordsList" class="records-list" style="display: none;">
                                <h5>🆕 新記錄預覽</h5>
                                <div class="records-preview" id="newRecordsPreview"></div>
                        </div>
                        
                            <div id="duplicateRecordsList" class="records-list" style="display: none;">
                                <h5>🔄 重複記錄</h5>
                                <div class="records-preview" id="duplicateRecordsPreview"></div>
                        </div>
                    </div>
                    
                        <!-- 匯入選擇界面 -->
                        <div id="importSelection" class="import-selection" style="display: none;">
                            <h4>📋 選擇要匯入的記錄</h4>
                            <div class="selection-controls">
                                <button class="btn btn-secondary" onclick="selectAllRecords()">全選</button>
                                <button class="btn btn-secondary" onclick="selectNewRecordsOnly()">只選新記錄</button>
                                <button class="btn btn-secondary" onclick="clearSelection()">清除選擇</button>
                        </div>
                            <div class="records-selection" id="recordsSelection"></div>
                            <div class="selection-actions">
                                <button class="btn btn-success" onclick="confirmSelectedImport()">確認匯入選中記錄</button>
                                <button class="btn btn-secondary" onclick="cancelImportSelection()">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 數據匯出功能 -->
                <div class="export-section">
                    <h3>📤 數據匯出</h3>
                    <p>將現有記錄匯出為 Excel 檔案</p>
                    <div class="export-actions">
                        <button class="btn" onclick="downloadExcelBackup()">📊 下載 Excel 備份</button>
                    </div>
                </div>
                
                <!-- Excel 匯入功能已整合到數據匯入區塊 -->
                
                <!-- GitHub 同步功能 -->
                <div class="github-sync-section">
                    <h3>☁️ GitHub 同步</h3>
                    <p>將資料同步到 GitHub 儲存庫</p>
                    
                    <div class="sync-info">
                        <div class="info-icon">ℹ️</div>
                        <div class="info-content">
                            <h4>同步說明</h4>
                            <p>手動同步將會：</p>
                            <ul>
                                <li>將所有本地記錄上傳到 GitHub</li>
                                <li>確保資料在雲端備份</li>
                                <li>可在其他裝置同步資料</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="sync-actions">
                        <button class="btn btn-primary" onclick="syncToGitHub()" id="syncBtn">
                            💾 儲存到 GitHub
                        </button>
                        <div id="syncStatus" class="sync-status" style="display: none;"></div>
                        
                        <!-- GitHub Token 狀態檢查 -->
                        <div class="github-token-status" style="margin-top: 20px;">
                            <h4>🔍 GitHub Token 狀態</h4>
                            <div id="tokenStatus" class="token-status"></div>
                            
                            <!-- Token 狀態操作按鈕 -->
                            <div class="token-actions">
                                <button class="btn btn-warning" onclick="checkTokenStatus()" id="checkTokenBtn">🔍 檢查 Token 狀態</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 資料清除功能 -->
                <div class="clear-section">
                    <h3>🗑️ 資料清除</h3>
                    <p>清除所有收支記錄數據</p>
                    
                    <div class="clear-warning">
                        <div class="warning-icon">⚠️</div>
                        <div class="warning-content">
                            <h4>警告：此操作不可逆</h4>
                            <p>清除資料將會：</p>
                            <ul>
                                <li>刪除所有收支記錄</li>
                                <li>清空統計數據</li>
                                <li>無法復原</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="clear-actions">
                        <button class="btn btn-danger" onclick="clearAllData()">🗑️ 清空所有數據</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 編輯記錄的模態框 -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>編輯記錄</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="editMember">成員</label>
                        <select id="editMember" required>
                            <option value="Kelvin">Kelvin</option>
                            <option value="Phuong">Phuong</option>
                            <option value="Ryan">Ryan</option>
                            <option value="家用">家用</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editType">類型</label>
                        <select id="editType" required>
                            <option value="income">收入</option>
                            <option value="expense">支出</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editAmount">金額</label>
                        <input type="number" id="editAmount" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                        <div class="form-group">
                            <label for="editMainCategory">主類別</label>
                            <select id="editMainCategory" required onchange="handleEditMainCategoryChange()">
                            </select>
                            <input type="text" id="editCustomMainCategory" placeholder="請輸入自定義主類別" style="display: none; margin-top: 10px;">
                        </div>
                    <div class="form-group">
                        <label for="editSubCategory">付款方式</label>
                        <select id="editSubCategory" required>
                            <option value="">請選擇付款方式</option>
                            <option value="信用卡">信用卡</option>
                            <option value="現金">現金</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editDescription">描述</label>
                    <textarea id="editDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="editDate">日期</label>
                    <input type="date" id="editDate" required>
                </div>
                <div style="text-align: right;">
                    <button type="button" class="btn btn-danger" onclick="closeModal()">取消</button>
                    <button type="submit" class="btn btn-success">儲存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 添加 CSV 和 Excel 解析庫 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- 添加 Chart.js 圖表庫 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="script.js"></script>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-version">
                <span class="footer-version-label">版本</span>
                <span class="footer-version-number" id="footerVersionNumber">載入中...</span>
            </div>
        </div>
    </footer>
</body>
</html>
// 觸發重新部署 - Thu Sep 25 15:25:15 CST 2025
